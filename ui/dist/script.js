const e=require("electron").remote.BrowserWindow;var t,r,s,n,a,i,o,l="40918ae807d24a16a7f8217fa1f445c0",c="b1506d8d8edf447a816d773def58a1c3";class d{constructor(e,t,r,s){this.will_refresh=!0,this.access_token=e,this.refresh_token=t,this.expires_in=r,this.will_refresh=s,s&&this.refresh()}refresh(){let e=1e3*this.expires_in,t=p.bind(null,this.refresh_token,!0);this.refresher=setInterval(t,e)}set willRefresh(e){e!==this.will_refresh&&(this.will_refresh=e,e?this.refresh():clearInterval(this.refresher))}revoke(){clearInterval(this.refresher)}}class h{constructor(e){this.authorizationCode=e}get authCode(){return this.authorizationCode}getAccessToken(){return this.expiringCredentials.access_token}}function u(){var s=["streaming","user-library-read","user-library-modify","user-read-birthdate","user-read-email","user-read-private"].join(" ");s=encodeURIComponent(s),r="https://localhost/index.html";var n="https://accounts.spotify.com/authorize?client_id="+l+"&response_type=code&scope="+s+"&redirect_uri="+encodeURIComponent(r);(t=new e({show:!1})).on("close",()=>{t=null},!1),t.loadURL(n),t.show();var a=t.webContents;a.on("will-navigate",(e,t)=>{m(t)}),a.on("did-get-redirect-request",(e,t,r)=>{m(r)})}function m(e){var r=r=/code=([^&]*)/.exec(e)||null,n=r&&r.length>1?r[1]:null,a=/\?error=(.+)$/.exec(e);(n||a)&&t.destroy(),n&&(s=new h(n),p(n))}function p(e,t=!1){let i=new URLSearchParams;i.append("grant_type","authorization_code"),i.append("code",e),i.append("redirect_uri",r),i.append("client_id",l),i.append("client_secret",c),fetch("https://accounts.spotify.com/api/token",{method:"POST",body:i.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(e=>{if(e.ok)return e.json()}).then(e=>{document.getElementById("content").innerHTML="Authorized! Code = "+e.access_token;let r=new d(e.access_token,e.refresh_token,e.expires_in,!0);t?(s.expiringCredentials.revoke(),s.expiringCredentials=r):s.expiringCredentials=r,function(){let e=document.createElement("script");e.src="https://sdk.scdn.co/spotify-player.js",document.body.appendChild(e),window.onSpotifyWebPlaybackSDKReady=(()=>{(n=new Spotify.Player({name:"JazzyTunes",getOAuthToken:e=>{e(s.getAccessToken())}})).on("account_error",({message:e})=>{alert("The account used to authorize does not have a valid Spotify Premium subscription!")}),n.addListener("player_state_changed",e=>{let t=e.track_window.current_track;if(t.name!=a.currenttrack){let e={name:t.name,albumcoveruri:t.album.images[0].url,albumname:t.album.name,artists:t.artists};a.setNewParams(e);let r=new _([t.id]);r.execute(b)}}),n.connect(),function(e){let t=function(e){let t=document.createElement("sidebar_element_header"),r=document.createElement("span");r.slot="header_text",r.innerHTML=e,t.appendChild(r);let s=document.createElement("span");s.slot="header_text",s.innerHTML=e,s.className="header_text";let n=[s],a=database.getElement("sidebar-element-header");a.populateSlots(n);let i=document.createElement("div");i.className="sidebar_entry",i=a.getElement(i);let o=document.createElement("div");return o.className="sidebar_entry_content",i.appendChild(o),i}("Playback Controls");document.getElementById("sidebar").appendChild(t);let r=function(e){let t=database.getElement("playback-controls-basic"),r=e.getElementsByClassName("sidebar_entry_content")[0];return t.getElement(r)}(t);a=new f(r)}()})}()})}document.addEventListener("dom:loaded",function(){document.getElementById("authorize").addEventListener("click",u)});class f{constructor(e){this.sidebarentry=e,this.imgholder=this.sidebarentry.getElementsByClassName("cover_img")[0],this.titleholder=this.sidebarentry.getElementsByClassName("title")[0],this.infoholder=this.sidebarentry.getElementsByClassName("artist_album")[0],this.rangebar=this.sidebarentry.getElementsByClassName("scrubbar")[0];let t=this.sidebarentry.getElementsByTagName("div"),r=t[0];this.controls=t[1],this.timecurrent=r.children[0],this.timefull=r.children[1]}setImg(e){this.imgholder.src=e}setTitle(e){this.titleholder.innerHTML=e,this.currenttrack=e}setArtistAlbum(e,t){let r=e+" - "+t;this.infoholder.innerHTML=r}setDuration(e){this.timefull.innerHTML=e}setNewParams(e){this.setImg(e.albumcoveruri),this.setTitle(e.name),this.setArtistAlbum(e.artists[0].name,e.albumname)}}function b(e){if(e.status==o.RESOLVED){let t=e.result.duration_ms,r=Math.floor(t/1e3),s=0;for(;r>59;)r-=60,s++;let n=s+":";n+=r>9?r:"0"+r,a.setDuration(n)}}!function(e){e[e.albums=0]="albums",e[e.artists=1]="artists",e[e.browse=2]="browse",e[e.recommendations=3]="recommendations",e[e.me=4]="me",e[e.users=5]="users",e[e.search=6]="search",e[e.tracks=7]="tracks",e[e["audio-analysis"]=8]="audio-analysis",e[e["audio-features"]=9]="audio-features"}(i||(i={})),function(e){e[e.UNRESOLVED=0]="UNRESOLVED",e[e.RESOLVING=1]="RESOLVING",e[e.RESOLVED=2]="RESOLVED",e[e.ERROR=3]="ERROR"}(o||(o={}));class y{constructor(e,t,r){this.status=o.UNRESOLVED,this.result=null,this.error=null,this.status=e,this.result=t,this.error=r}}class E{constructor(){this.baseURL="https://api.spotify.com/v1/"}parseOptions(e){let t="",r=e.keys(),s=e.length;for(var n=0;n<s;n++){let a=r[n]+"="+e[n];t+=a+=n<s-1?"&":""}return t}execute(e){fetch(this.url,{headers:{Authorization:"Bearer "+s.getAccessToken()}}).then(function(e){if(e.ok)return e.json();alert("Error!")}).then(function(t){let r;r=t.error?new y(o.ERROR,t.error,t.error_description):new y(o.RESOLVED,t),e(r)})}}class _ extends E{constructor(e){if(super(),e.length>1){let t=e.join(",");this.url=this.baseURL+"tracks/"+t}else this.url=this.baseURL+"tracks/"+e[0]}}