const e=require("electron"),t=e.remote,s=t.BrowserWindow;var r,n,i="40918ae807d24a16a7f8217fa1f445c0",a="b1506d8d8edf447a816d773def58a1c3",o,l,c,u,h;class d{constructor(e,t,s,r){this.will_refresh=!0,this.access_token=e,this.refresh_token=t,this.expires_in=s,this.will_refresh=r,r&&this.refresh()}refresh(){let e=1e3*this.expires_in,t=f.bind(null,this.refresh_token,!0);this.refresher=setInterval(t,e)}set willRefresh(e){e!==this.will_refresh&&(this.will_refresh=e,e?this.refresh():clearInterval(this.refresher))}revoke(){clearInterval(this.refresher)}}class p{constructor(e){this.authorizationCode=e}get authCode(){return this.authorizationCode}getAccessToken(){return this.expiringCredentials.access_token}}function m(){var e,t=["streaming","user-library-read","user-library-modify","user-read-birthdate","user-read-email","user-read-private"].join(" ");t=encodeURIComponent(t),n="https://localhost/index.html";var a="https://accounts.spotify.com/authorize?client_id="+i+"&response_type=code&scope="+t+"&redirect_uri="+encodeURIComponent(n);(r=new s({show:!1})).on("close",()=>{r=null},!1),r.loadURL(a),r.show();var o=r.webContents;o.on("will-navigate",(e,t)=>{b(t)}),o.on("did-get-redirect-request",(e,t,s)=>{b(s)})}function b(e){var t=t=/code=([^&]*)/.exec(e)||null,s=t&&t.length>1?t[1]:null,n=/\?error=(.+)$/.exec(e);(s||n)&&r.destroy(),s&&(o=new p(s),f(s))}function f(e,t=!1){let s=new URLSearchParams;s.append("grant_type","authorization_code"),s.append("code",e),s.append("redirect_uri",n),s.append("client_id",i),s.append("client_secret",a),fetch("https://accounts.spotify.com/api/token",{method:"POST",body:s.toString(),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"}}).then(e=>{if(e.ok)return e.json()}).then(e=>{let s;document.getElementById("content").innerHTML="Authorized! Code = "+e.access_token;let r=new d(e.access_token,e.refresh_token,e.expires_in,!0);t?(o.expiringCredentials.revoke(),o.expiringCredentials=r):o.expiringCredentials=r,E()})}function y(e){let t=document.createElement("sidebar_element_header"),s=document.createElement("span");s.slot="header_text",s.innerHTML=e,t.appendChild(s);let r=document.createElement("span");r.slot="header_text",r.innerHTML=e,r.className="header_text";let n=[r],i=database.getElement("sidebar-element-header");i.populateSlots(n);let a=document.createElement("div");a.className="sidebar_entry",a=i.getElement(a);let o=document.createElement("div");return o.className="sidebar_entry_content",a.appendChild(o),a}function R(e){let t=database.getElement("playback-controls-basic"),s=e.getElementsByClassName("sidebar_entry_content")[0];return t.getElement(s)}document.addEventListener("dom:loaded",function(){document.getElementById("authorize").addEventListener("click",m)});class g{constructor(e){this.sidebarentry=e,this.imgholder=this.sidebarentry.getElementsByClassName("cover_img")[0],this.titleholder=this.sidebarentry.getElementsByClassName("title")[0],this.infoholder=this.sidebarentry.getElementsByClassName("artist_album")[0],this.rangebar=this.sidebarentry.getElementsByClassName("scrubbar")[0];let t=this.sidebarentry.getElementsByTagName("div"),s=t[0];this.controls=t[1],this.timecurrent=s.children[0],this.timefull=s.children[1]}setImg(e){this.imgholder.src=e}setTitle(e){this.titleholder.innerHTML=e,this.currenttrack=e}setArtistAlbum(e,t){let s=e+" - "+t;this.infoholder.innerHTML=s}setDuration(e){this.timefull.innerHTML=e}setNewParams(e){this.setImg(e.albumcoveruri),this.setTitle(e.name),this.setArtistAlbum(e.artists[0].name,e.albumname)}}function E(){let e=document.createElement("script");e.src="https://sdk.scdn.co/spotify-player.js",document.body.appendChild(e),window.onSpotifyWebPlaybackSDKReady=(()=>{(l=new Spotify.Player({name:"JazzyTunes",getOAuthToken:e=>{e(o.getAccessToken())}})).on("account_error",({message:e})=>{alert("The account used to authorize does not have a valid Spotify Premium subscription!")}),l.addListener("player_state_changed",e=>{let t=e.track_window.current_track;if(t.name!=c.currenttrack){let e={name:t.name,albumcoveruri:t.album.images[0].url,albumname:t.album.name,artists:t.artists},s;c.setNewParams(e),new $([t.id]).execute(w)}}),l.connect(),L(l)})}function L(e){let t=y("Playback Controls");document.getElementById("sidebar").appendChild(t);let s=R(t);c=new g(s)}function w(e){if(e.status==h.RESOLVED){let t=e.result.duration_ms,s=Math.floor(t/1e3),r=0;for(;s>59;)s-=60,r++;let n=r+":";n+=s>9?s:"0"+s,c.setDuration(n)}}!function(e){e[e.albums=0]="albums",e[e.artists=1]="artists",e[e.browse=2]="browse",e[e.recommendations=3]="recommendations",e[e.me=4]="me",e[e.users=5]="users",e[e.search=6]="search",e[e.tracks=7]="tracks",e[e["audio-analysis"]=8]="audio-analysis",e[e["audio-features"]=9]="audio-features"}(u||(u={})),function(e){e[e.UNRESOLVED=0]="UNRESOLVED",e[e.RESOLVING=1]="RESOLVING",e[e.RESOLVED=2]="RESOLVED",e[e.ERROR=3]="ERROR"}(h||(h={}));class _{constructor(e,t,s){this.status=h.UNRESOLVED,this.result=null,this.error=null,this.status=e,this.result=t,this.error=s}}class x{constructor(){this.baseURL="https://api.spotify.com/v1/"}parseOptions(e){let t="",s=e.keys(),r=e.length;for(var n=0;n<r;n++){let i=s[n]+"="+e[n];t+=i+=n<r-1?"&":""}return t}execute(e){fetch(this.url,{headers:{Authorization:"Bearer "+o.getAccessToken()}}).then(function(e){if(e.ok)return e.json();alert("Error!")}).then(function(t){let s;s=t.error?new _(h.ERROR,t.error,t.error_description):new _(h.RESOLVED,t),e(s)})}}class k{constructor(e){this.baseURL="https://api.spotify.com/v1/",this.bodyJson=!0,this.bodyJson=e}createBody(e){let t=new URLSearchParams;for(var s in e)t.append(s,e[s]);return t.toString()}parseOptions(e){let t="",s=e.keys(),r=e.length;for(var n=0;n<r;n++){let i=s[n]+"="+e[n];t+=i+=n<r-1?"&":""}return t}execute(e){fetch(this.url,{method:"PUT",headers:{Authorization:"Bearer "+o.getAccessToken(),"Content-Type":"application/json"},body:this.bodyJson?JSON.stringify(this.body):this.createBody(this.body)}).then(function(e){if(e.ok)return e.json();alert("Error!")}).then(function(t){let s;s=t.error?new _(h.ERROR,t.error,t.error_description):new _(h.RESOLVED,t),e(s)})}}class U{}class O extends x{constructor(e,t){super(),this.url=this.baseURL+"albums/"+e+"?"+this.parseOptions(t)}}class v extends x{constructor(e,t){super(),this.url=this.baseURL+"albums/"+e+"/tracks?"+this.parseOptions(t)}}class C extends x{constructor(e,t){super();let s=e.join(",");t.ids=s,this.url=this.baseURL+"albums/?"+this.parseOptions(t)}}class S extends x{constructor(e){super(),this.url=this.baseURL+"artists/"+e}}class T extends x{constructor(e,t){super(),this.url=this.baseURL+"artists/"+e+"/albums?"+this.parseOptions(t)}}class N extends x{constructor(e,t){super(),this.url=this.baseURL+"artists/"+e+"/toptracks?country="+t}}class B extends x{constructor(e){super(),this.url=this.baseURL+"artists/"+e+"/related-artists"}}class A extends x{constructor(e){super();let t=e.join(",");this.url=this.baseURL+"albums/?ids="+t}}class I extends x{constructor(e,t){super(),this.url=this.baseURL+"browse/categories/"+e+"?"+this.parseOptions(t)}}class j extends x{constructor(e,t){super(),this.url=this.baseURL+"browse/categories/"+e+"/playlists?"+this.parseOptions(t)}}class z extends x{constructor(e){super(),this.url=this.baseURL+"browse/categories?"+this.parseOptions(e)}}class D extends x{constructor(e){super(),this.url=this.baseURL+"browse/featured-playlists?"+this.parseOptions(e)}}class P extends x{constructor(e){super(),this.url=this.baseURL+"browse/new-releases?"+this.parseOptions(e)}}class V extends x{constructor(e){super(),this.url=this.baseURL+"recommendations?"+this.parseOptions(e)}}class M extends x{constructor(e){super(),this.url=this.baseURL+"me/following/contains?"+this.parseOptions(e)}}class H extends x{constructor(e,t,s){super();let r=s.join(",");this.url=this.baseURL+"users/"+e+"/playlists/"+t+"/followers/contains?"+r}}class J extends k{}class q extends k{}class G extends U{}class W extends U{}class F extends x{constructor(e){super(),this.url=this.baseURL+"audio-analysis/"+e}}class K extends x{constructor(e){if(super(),e.length>1){let t=e.join(",");this.url=this.baseURL+"audio-features/"+t}else this.url=this.baseURL+"audio-features/"+e[0]}}class $ extends x{constructor(e){if(super(),e.length>1){let t=e.join(",");this.url=this.baseURL+"tracks/"+t}else this.url=this.baseURL+"tracks/"+e[0]}}